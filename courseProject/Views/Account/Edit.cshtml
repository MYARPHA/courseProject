@model courseProject.Models.User
@{
    ViewData["Title"] = "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è";
}

<div class="page-header">
    <h1 class="page-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h1>
</div>

<div class="card">
    <div class="card-body">
        <form asp-action="Edit" method="post" enctype="multipart/form-data">
            <div class="mb-3">
                <label class="form-label">Email</label>
                <input class="form-control" value="@Model.Email" disabled />
            </div>

            <div class="mb-3">
                <label asp-for="FullName" class="form-label">–ò–º—è</label>
                <input asp-for="FullName" class="form-control" />
            </div>

            <div class="mb-3">
                <label class="form-label">–í—ã–±—Ä–∞—Ç—å –∞–≤–∞—Ç–∞—Ä (–ª–æ–∫–∞–ª—å–Ω–æ)</label>
                <div class="d-flex align-items-center gap-3 mb-2">
                    <div id="editAvatarPreview" style="width:96px;height:96px;border-radius:12px;overflow:hidden;background:#f1f1f1;display:flex;align-items:center;justify-content:center;font-size:36px;">
                        @if (!string.IsNullOrEmpty(Model.AvatarPath))
                        {
                            <img src="@Model.AvatarPath" alt="avatar" style="width:96px;height:96px;object-fit:cover;" />
                        }
                        else
                        {
                            <div id="editAvatarPlaceholder">üë§</div>
                        }
                    </div>
                    <div>
                        <input type="file" name="avatarFile" accept="image/*" class="form-control" id="avatarFileInput" />
                        <div class="form-text">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ ‚Äî –æ–Ω –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è.</div>
                    </div>
                </div>
                <div class="d-flex gap-2" id="avatarChoices">
                    <button type="button" class="btn btn-light avatar-choice" data-avatar="üßæ">üßæ</button>
                    <button type="button" class="btn btn-light avatar-choice" data-avatar="üìä">üìä</button>
                    <button type="button" class="btn btn-light avatar-choice" data-avatar="üßë‚Äçüíº">üßë‚Äçüíº</button>
                    <button type="button" class="btn btn-light avatar-choice" data-avatar="üë©‚Äçüíº">üë©‚Äçüíº</button>
                </div>
            </div>

            <div class="mb-3">
                <label asp-for="Phone" class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                <input asp-for="Phone" class="form-control" />
            </div>

            <div class="mb-3">
                <label class="form-label">–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</label>
                <input type="password" name="currentPassword" class="form-control mb-2" placeholder="–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å" />
                <input type="password" name="newPassword" class="form-control mb-2" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" />
                <input type="password" name="confirmPassword" class="form-control" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" />
            </div>

            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-dark">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <a asp-action="Profile" class="btn btn-outline-secondary">–û—Ç–º–µ–Ω–∞</a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        // show saved avatar selection and preview uploaded file
        (function(){
            function renderAvatarPreviewFromLocal() {
                const avatar = localStorage.getItem('userAvatar');
                document.querySelectorAll('.avatar-choice').forEach(b => {
                    b.classList.toggle('active', b.getAttribute('data-avatar') === avatar);
                });
                const preview = document.getElementById('editAvatarPreview');
                if (preview && !preview.querySelector('img')) {
                    const ph = document.getElementById('editAvatarPlaceholder');
                    if (ph) ph.innerText = avatar || 'üë§';
                }
            }

            document.querySelectorAll('.avatar-choice').forEach(b => {
                b.addEventListener('click', () => {
                    const a = b.getAttribute('data-avatar');
                    localStorage.setItem('userAvatar', a);
                    renderAvatarPreviewFromLocal();
                    alert('–ê–≤–∞—Ç–∞—Ä —Å–æ—Ö—Ä–∞–Ω—ë–Ω –ª–æ–∫–∞–ª—å–Ω–æ');
                });
            });

            // file input preview
            const fileInput = document.getElementById('avatarFileInput');
            if (fileInput) {
                fileInput.addEventListener('change', () => {
                    const f = fileInput.files && fileInput.files[0];
                    if (!f) return;
                    const reader = new FileReader();
                    reader.onload = function (ev) {
                        const preview = document.getElementById('editAvatarPreview');
                        if (!preview) return;
                        preview.innerHTML = '';
                        const img = document.createElement('img');
                        img.src = ev.target.result;
                        img.style.width = '96px'; img.style.height = '96px'; img.style.objectFit = 'cover';
                        preview.appendChild(img);
                    };
                    reader.readAsDataURL(f);
                });
            }

            renderAvatarPreviewFromLocal();
        })();
    </script>
}
