@model courseProject.Models.User
@{
    ViewData["Title"] = "Редактирование профиля";
}

<div class="page-header">
    <h1 class="page-title">Редактировать профиль</h1>
</div>

<div class="card">
    <div class="card-body">
        <form asp-action="Edit" method="post" enctype="multipart/form-data">
            <div class="mb-3">
                <label class="form-label">Email</label>
                <input class="form-control" value="@Model.Email" disabled />
            </div>

            <div class="mb-3">
                <label asp-for="FullName" class="form-label">Имя</label>
                <input asp-for="FullName" class="form-control" />
            </div>

            <div class="mb-3">
                <label class="form-label">Выбрать аватар (локально)</label>
                <div class="d-flex align-items-center gap-3 mb-2">
                    <div id="editAvatarPreview" style="width:96px;height:96px;border-radius:12px;overflow:hidden;background:#f1f1f1;display:flex;align-items:center;justify-content:center;font-size:36px;">
                        @if (!string.IsNullOrEmpty(Model.AvatarPath))
                        {
                            <img src="@Model.AvatarPath" alt="avatar" style="width:96px;height:96px;object-fit:cover;" />
                        }
                        else
                        {
                            <div id="editAvatarPlaceholder"></div>
                        }
                    </div>
                    <div>
                        <input type="file" name="avatarFile" accept="image/*" id="avatarFileInput" style="display:none;" />
                        <label for="avatarFileInput" class="btn btn-outline-dark file-input-btn">Выбрать файл</label>
                        <span id="avatarFileName" class="ms-2 text-muted">Файл не выбран</span>
                        <div class="form-text">Выберите файл с устройства — он будет загружен при сохранении профиля.</div>
                    </div>
                </div>
                @* Avatar choice emojis removed per request *@
            </div>

            <div class="mb-3">
                <label asp-for="Phone" class="form-label">Телефон</label>
                <input asp-for="Phone" class="form-control" />
            </div>

            <div class="mb-3">
                <label class="form-label">Изменить пароль</label>
                <input type="password" name="currentPassword" class="form-control mb-2" placeholder="Текущий пароль" />
                <input type="password" name="newPassword" class="form-control mb-2" placeholder="Новый пароль" />
                <input type="password" name="confirmPassword" class="form-control" placeholder="Подтвердите новый пароль" />
            </div>

            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-dark">Сохранить</button>
                <a asp-action="Profile" class="btn btn-outline-secondary">Отмена</a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        // show saved avatar selection and preview uploaded file
        (function(){
            // file input preview and file name display
            const fileInput = document.getElementById('avatarFileInput');
            const fileNameSpan = document.getElementById('avatarFileName');
            if (fileInput) {
                fileInput.addEventListener('change', () => {
                    const f = fileInput.files && fileInput.files[0];
                    if (!f) {
                        if (fileNameSpan) fileNameSpan.innerText = 'Файл не выбран';
                        return;
                    }
                    if (fileNameSpan) fileNameSpan.innerText = f.name;
                    const reader = new FileReader();
                    reader.onload = function (ev) {
                        const preview = document.getElementById('editAvatarPreview');
                        if (!preview) return;
                        preview.innerHTML = '';
                        const img = document.createElement('img');
                        img.src = ev.target.result;
                        img.style.width = '96px'; img.style.height = '96px'; img.style.objectFit = 'cover';
                        preview.appendChild(img);
                    };
                    reader.readAsDataURL(f);
                });
            }

            // remove local emoji avatar usage — keep preview blank when no server avatar
            const ph = document.getElementById('editAvatarPlaceholder');
            if (ph) ph.innerText = '';
        })();
    </script>
}
